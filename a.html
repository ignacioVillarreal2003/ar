<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ğŸ” BÃºsqueda del Tesoro AR</title>

  <!-- LibrerÃ­as -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.min.js"></script>

  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
    }

    a-scene {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1; /* cÃ¡mara al fondo */
    }

    /* HUD flotante */
    #hud {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.4);
      color: white;
      font-family: 'Segoe UI', sans-serif;
      padding: 8px 14px;
      border-radius: 10px;
      text-align: center;
      z-index: 100;
      pointer-events: none;
    }

    #final {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.85);
      color: gold;
      font-size: 2em;
      font-weight: bold;
      z-index: 200;
      animation: fadeIn 2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>

<body>
  <div id="hud">ğŸ§­ EscaneÃ¡ el marcador inicial (HIRO)...</div>
  <div id="final">ğŸ‰ Â¡Encontraste el tesoro! ğŸ†</div>

  <a-scene
    vr-mode-ui="enabled: false"
    embedded
    renderer="logarithmicDepthBuffer: true;"
    arjs="sourceType: webcam; debugUIEnabled: false;">
    
    <!-- Marcador 1: HIRO (inicio) -->
    <a-marker id="hiroMarker" preset="hiro">
      <a-text value="Inicio del juego" color="yellow" position="0 0.8 0" align="center"></a-text>
      <a-box position="0 0.25 0" color="orange" depth="0.4" height="0.4" width="0.4"
             animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
    </a-marker>

    <!-- Marcador 2: KANJI -->
    <a-marker id="kanjiMarker" preset="kanji">
      <a-sphere color="deepskyblue" radius="0.3" position="0 0.25 0"
                animation="property: position; to: 0 0.5 0; dir: alternate; loop: true; dur: 1000"></a-sphere>
      <a-text value="Pista intermedia" color="lightblue" position="0 0.8 0" align="center"></a-text>
    </a-marker>

    <!-- Marcador 3: letterA -->
    <a-marker id="aMarker" type="pattern" preset="letterA">
      <a-torus-knot color="lime" radius="0.3" position="0 0.25 0"
                    animation="property: rotation; to: 360 360 0; loop: true; dur: 2500"></a-torus-knot>
      <a-text value="Tesoro" color="lime" position="0 0.8 0" align="center"></a-text>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const hud = document.getElementById("hud");
      const final = document.getElementById("final");

      const sequence = ["hiroMarker", "kanjiMarker", "aMarker"];
      let currentStep = 0;

      const updateHUD = (text) => {
        hud.textContent = text;
      };

      const handleMarker = (id) => {
        const expected = sequence[currentStep];
        if (id === expected) {
          currentStep++;
          if (currentStep < sequence.length) {
            const nextName =
              sequence[currentStep] === "kanjiMarker"
                ? "KANJI"
                : sequence[currentStep] === "aMarker"
                ? "LetterA"
                : "Desconocido";
            updateHUD(`âœ… Â¡Bien! Ahora buscÃ¡ el marcador ${nextName}...`);
          } else {
            updateHUD("ğŸ‰ Â¡Todos los marcadores encontrados!");
            final.style.display = "flex";
          }
        } else if (currentStep < sequence.length) {
          updateHUD("âš ï¸ Ese marcador no corresponde todavÃ­a...");
        }
      };

      sequence.forEach((id) => {
        const marker = document.getElementById(id);
        marker.addEventListener("markerFound", () => handleMarker(id));
      });

      console.log("ğŸ§­ Juego AR listo. Orden: HIRO â†’ KANJI â†’ LetterA");
    });
  </script>
</body>
</html>
